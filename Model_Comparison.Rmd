---
title: "Model Comparison"
author: "Baoyi Shi"
output: 
  pdf_document:
    number_sections: true
header-includes:
- \usepackage{caption}
---

```{r echo=FALSE,warning=FALSE,message=FALSE}
rm(list=ls())
library(CMA)
df_int <- read.csv("int_data_10000.txt", sep = " ")
df_noint <- read.csv("noint_data_10000.txt", sep = " ")
df_mulipleM_noint <- read.csv("multipleM_noint_data_10000.txt", sep = " ")
df_mulipleM_EMint <- read.csv("multipleM_EMint_data_10000.txt", sep = " ")
df_mulipleM_MMint <- read.csv("multipleM_MMint_data_10000.txt", sep = " ")
df_mulipleM_mint <- read.csv("multipleM_mint_data_10000.txt", sep = " ")
```

# Case 1: Continuous Outcome and Continuous Mediator

## Case 1-1: Continuous Outcome and Single Continuous Mediator Without Exposure-mediator Interaction

### Data simulation

#### Simulation Procedures

1. Simulate the exposure variable A from Binom(1,P(A=1)).

2. Simulate the covariate C from $N(\mu_C,\sigma_C^2)$.

3. Simulate the mediator M from $N((\beta_0+\beta_1*A+\beta_2*C),\sigma_M^2)$.

4. Simulate the outcome Y from $N(\theta_0+\theta_1A+\theta_2M+\theta_4C,\sigma_Y^2)$.

#### True Parameters

\begin{center}
\captionof{table}{True Model Parameters for Data Simulation}
\begin{tabular}{l|l|l|l|l|l|l|l|l|l|l|l|l}
\hline
Sample Size & $\theta_0$ & $\theta_1$ & $\theta_2$ & $\theta_4$ & $\beta_0$ & $\beta_1$ & $\beta_2$ & P(A=1) & $\mu_C$ & $\sigma_C$ & $\sigma_M$ & $\sigma_Y$\\ \hline
10000&-5&0.8&1.8&0.1&-0.25&0.5&0.2&0.4&1&1&0.1&0.2 \\ \hline
\end{tabular}
\end{center}

#### True Models

True model for the mediator:
$$E[M|a,c]=\beta_0+\beta_1a+\beta_2c$$

True model for the outcome:
$$E[Y|a,m^*,c]=\theta_0+\theta_1a+\theta_2m^*+\theta_4c$$

### Causal Effects and Standard Errors Estimated By the Regression-based Approach

#### Closed-form Parameter Function Estimation and Delta Method Inference

```{r warning=F,message=F}

causal_mediation(data = df_noint,  outcome = "contY_contM_noint", exposure = 'A', 
                 exposure.type = "binary",
                 mediator = 'M_cont', covariates.pre = "C",  covariates.post = NULL,
                        covariates.post.type = NULL, cval = list(mean(df_noint$C)),
                        EMint = FALSE, MMint = NULL, EMMint = NULL, EMint.terms = NULL,
                        MMint.terms = NULL, EMMint.terms = NULL,
                        yreg = "linear", mreg = "linear", mval = list(0),
                        a_star = 0, a = 1, 
                        est.method = "paramfunc", inf.method = "delta", model = "rb",
                        nboot = 200, conf = 0.95, nrep = 5)

```

#### Direct Imputation Estimation and Bootstrap Inference

```{r warning=F,message=F}

causal_mediation(data = df_noint,  outcome = "contY_contM_noint", exposure = 'A', 
                 exposure.type = "binary",
                 mediator = 'M_cont', covariates.pre = "C",  covariates.post = NULL,
                        covariates.post.type = NULL, cval = list(),
                        EMint = FALSE, MMint = NULL, EMMint = NULL, EMint.terms = NULL,
                        MMint.terms = NULL, EMMint.terms = NULL,
                        yreg = "linear", mreg = "linear", mval = list(0),
                        a_star = 0, a = 1, 
                        est.method = "imputation", inf.method = "bootstrap", model = "rb",
                        nboot = 200, conf = 0.95, nrep = 5)

```

### Causal Effects and Standard Errors Estimated By the Weighting-based Approach

```{r warning=F,message=F}

causal_mediation(data = df_noint,  outcome = "contY_contM_noint", exposure = 'A', 
                 exposure.type = "binary",
                 mediator = 'M_cont', covariates.pre = "C",  covariates.post = NULL,
                        covariates.post.type = NULL, cval = list(),
                        EMint = FALSE, MMint = NULL, EMMint = NULL, EMint.terms = NULL,
                        MMint.terms = NULL, EMMint.terms = NULL,
                        yreg = "linear", mreg = "linear", mval = list(0),
                        a_star = 0, a = 1, 
                        est.method = "imputation", inf.method = "bootstrap", model = "wb",
                        nboot = 200, conf = 0.95, nrep = 5)

```

### Causal Effects and Standard Errors Estimated By the Marginal Structural Model 

```{r warning=F,message=F}

causal_mediation(data = df_noint,  outcome = "contY_contM_noint", exposure = "A", 
                 exposure.type = "binary",
                 mediator = 'M_cont', covariates.pre = "C",  covariates.post = NULL,
                        covariates.post.type = NULL, cval = list(mean(df_noint$C)),
                        EMint = FALSE, MMint = NULL, EMMint = NULL, EMint.terms = NULL,
                        MMint.terms = NULL, EMMint.terms = NULL,
                        yreg = "linear", mreg = "linear", mval = list(0),
                        a_star = 0, a = 1, 
                        est.method = "imputation", inf.method = "bootstrap", model = "msm",
                        nboot = 200, conf = 0.95, nrep = 5)

```

### Causal Effects and Standard Errors Estimated By the Inverse Odds-ratio Weighting Approach 

```{r warning=F,message=F}

causal_mediation(data = df_noint,  outcome = "contY_contM_noint", exposure = 'A', 
                 exposure.type = "binary",
                 mediator = 'M_cont', covariates.pre = "C",  covariates.post = NULL,
                        covariates.post.type = NULL, cval = list(),
                        EMint = FALSE, MMint = NULL, EMMint = NULL, EMint.terms = NULL,
                        MMint.terms = NULL, EMMint.terms = NULL,
                        yreg = "linear", mreg = "linear", mval = list(0),
                        a_star = 0, a = 1, 
                        est.method = "paramfunc", inf.method = "bootstrap", model = "iorw",
                        nboot = 200, conf = 0.95, nrep = 5)

```

### Causal Effects and Standard Errors Estimated By the G-formula Approach 

```{r warning=F,message=F}

causal_mediation(data = df_noint,  outcome = "contY_contM_noint", exposure = 'A', 
                 exposure.type = "binary",
                 mediator = 'M_cont', covariates.pre = "C",  covariates.post = NULL,
                        covariates.post.type = NULL, cval = list(),
                        EMint = FALSE, MMint = NULL, EMMint = NULL, EMint.terms = NULL,
                        MMint.terms = NULL, EMMint.terms = NULL,
                        yreg = "linear", mreg = "linear", mval = list(0),
                        a_star = 0, a = 1, 
                        est.method = "imputation", inf.method = "bootstrap", model = "g-formula",
                        nboot = 200, conf = 0.95, nrep = 5)

```

### Causal Effects and Standard Errors Estimated By the Natural Effect Model 

```{r warning=F,message=F}
causal_mediation(data = df_noint,  outcome = "contY_contM_noint", exposure = 'A', 
                 exposure.type = "binary",
                 mediator = 'M_cont', covariates.pre = "C",  covariates.post = NULL,
                        covariates.post.type = NULL, cval = NULL,
                        EMint = FALSE, MMint = NULL, EMMint = NULL, EMint.terms = NULL,
                        MMint.terms = NULL, EMMint.terms = NULL,
                        yreg = "linear", mreg = "linear", mval = list(0),
                        a_star = 0, a = 1, 
                        est.method = NULL, inf.method = NULL, model = "ne",
                        nboot = 200, conf = 0.95, nrep = 5)
```


## Case 1-2: Continuous Outcome and Single Continuous Mediator With Exposure-mediator Interaction

### Data simulation

#### Simulation Procedures

1. Simulate the exposure variable A from Binom(1,P(A=1)).

2. Simulate the covariate C from $N(\mu_C,\sigma_C^2)$.

3. Simulate the mediator M from $N((\beta_0+\beta_1*A+\beta_2*C),\sigma_M^2)$.

4. Simulate the outcome Y from $N(\theta_0+\theta_1A+\theta_2M+\theta_3AM+\theta_4C,\sigma_Y^2)$.

#### True Parameters

\begin{center}
\captionof{table}{True Model Parameters for Data Simulation}
\begin{tabular}{l|l|l|l|l|l|l|l|l|l|l|l|l|l}
\hline
Sample Size & $\theta_0$ & $\theta_1$ & $\theta_2$ & $\theta_3$ & $\theta_4$ & $\beta_0$ & $\beta_1$ & $\beta_2$ & P(A=1) & $\mu_C$ & $\sigma_C$ & $\sigma_M$ & $\sigma_Y$\\ \hline
10000&-5&0.8&1.8&0.2&0.1&-0.25&0.5&0.2&0.4&1&1&0.1&0.2 \\ \hline
\end{tabular}
\end{center}

#### True Models

True model for the mediator:
$$E[M|a,c]=\beta_0+\beta_1a+\beta_2c$$

True model for the outcome:
$$E[Y|a,m^*,c]=\theta_0+\theta_1a+\theta_2m^*+\theta_3am^*+\theta_4c$$

### Causal Effects and Standard Errors Estimated By the Regression-based Approach

#### Closed-form Parameter Function Estimation and Delta Method Inference

```{r warning=F,message=F}

causal_mediation(data = df_int,  outcome = "contY_contM_int", exposure = 'A', 
                 exposure.type = "binary",
                 mediator = 'M_cont', covariates.pre = "C",  covariates.post = NULL,
                        covariates.post.type = NULL, cval = list(mean(df_noint$C)),
                        EMint = TRUE, MMint = NULL, EMMint = NULL, EMint.terms = NULL,
                        MMint.terms = NULL, EMMint.terms = NULL,
                        yreg = "linear", mreg = "linear", mval = list(0),
                        a_star = 0, a = 1, 
                        est.method = "paramfunc", inf.method = "delta", model = "rb",
                        nboot = 200, conf = 0.95, nrep = 5)

```

#### Direct Imputation Estimation and Bootstrap Inference

```{r warning=F,message=F}

causal_mediation(data = df_int,  outcome = "contY_contM_int", exposure = 'A', 
                 exposure.type = "binary",
                 mediator = 'M_cont', covariates.pre = "C",  covariates.post = NULL,
                        covariates.post.type = NULL, cval = list(),
                        EMint = TRUE, MMint = NULL, EMMint = NULL, EMint.terms = NULL,
                        MMint.terms = NULL, EMMint.terms = NULL,
                        yreg = "linear", mreg = "linear", mval = list(0),
                        a_star = 0, a = 1, 
                        est.method = "imputation", inf.method = "bootstrap", model = "rb",
                        nboot = 200, conf = 0.95, nrep = 5)

```

### Causal Effects and Standard Errors Estimated By the Weighting-based Approach

```{r warning=F,message=F}

causal_mediation(data = df_int,  outcome = "contY_contM_int", exposure = 'A', 
                 exposure.type = "binary",
                 mediator = 'M_cont', covariates.pre = "C",  covariates.post = NULL,
                        covariates.post.type = NULL, cval = list(),
                        EMint = TRUE, MMint = NULL, EMMint = NULL, EMint.terms = NULL,
                        MMint.terms = NULL, EMMint.terms = NULL,
                        yreg = "linear", mreg = "linear", mval = list(0),
                        a_star = 0, a = 1, 
                        est.method = "imputation", inf.method = "bootstrap", model = "wb",
                        nboot = 200, conf = 0.95, nrep = 5)

```

### Causal Effects and Standard Errors Estimated By the Marginal Structural Model 

```{r warning=F,message=F}

causal_mediation(data = df_int,  outcome = "contY_contM_int", exposure = "A", 
                 exposure.type = "binary",
                 mediator = 'M_cont', covariates.pre = "C",  covariates.post = NULL,
                        covariates.post.type = NULL, cval = list(mean(df_noint$C)),
                        EMint = TRUE, MMint = NULL, EMMint = NULL, EMint.terms = NULL,
                        MMint.terms = NULL, EMMint.terms = NULL,
                        yreg = "linear", mreg = "linear", mval = list(0),
                        a_star = 0, a = 1, 
                        est.method = "imputation", inf.method = "bootstrap", model = "msm",
                        nboot = 200, conf = 0.95, nrep = 5)

```

### Causal Effects and Standard Errors Estimated By the Inverse Odds-ratio Weighting Approach 

```{r warning=F,message=F}

causal_mediation(data = df_int,  outcome = "contY_contM_int", exposure = 'A', 
                 exposure.type = "binary",
                 mediator = 'M_cont', covariates.pre = "C",  covariates.post = NULL,
                        covariates.post.type = NULL, cval = list(),
                        EMint = TRUE, MMint = NULL, EMMint = NULL, EMint.terms = NULL,
                        MMint.terms = NULL, EMMint.terms = NULL,
                        yreg = "linear", mreg = "linear", mval = list(0),
                        a_star = 0, a = 1, 
                        est.method = "paramfunc", inf.method = "bootstrap", model = "iorw",
                        nboot = 200, conf = 0.95, nrep = 5)

```

### Causal Effects and Standard Errors Estimated By the G-formula Approach 

```{r warning=F,message=F}

causal_mediation(data = df_int,  outcome = "contY_contM_int", exposure = 'A', 
                 exposure.type = "binary",
                 mediator = 'M_cont', covariates.pre = "C",  covariates.post = NULL,
                        covariates.post.type = NULL, cval = list(),
                        EMint = TRUE, MMint = NULL, EMMint = NULL, EMint.terms = NULL,
                        MMint.terms = NULL, EMMint.terms = NULL,
                        yreg = "linear", mreg = "linear", mval = list(0),
                        a_star = 0, a = 1, 
                        est.method = "imputation", inf.method = "bootstrap", model = "g-formula",
                        nboot = 200, conf = 0.95, nrep = 5)

```

### Causal Effects and Standard Errors Estimated By the Natural Effect Model 

```{r warning=F,message=F}
causal_mediation(data = df_int,  outcome = "contY_contM_int", exposure = 'A', 
                 exposure.type = "binary",
                 mediator = 'M_cont', covariates.pre = "C",  covariates.post = NULL,
                        covariates.post.type = NULL, cval = NULL,
                        EMint = TRUE, MMint = NULL, EMMint = NULL, EMint.terms = NULL,
                        MMint.terms = NULL, EMMint.terms = NULL,
                        yreg = "linear", mreg = "linear", mval = list(0),
                        a_star = 0, a = 1, 
                        est.method = NULL, inf.method = NULL, model = "ne",
                        nboot = 200, conf = 0.95, nrep = 5)
```

